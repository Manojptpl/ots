<script src="~/Scripts/FileSaver.min.js"></script>
<script src="~/Scripts/html2canvas.js"></script>
<link rel="stylesheet" href="~/Content/tableexport.min.css" />
<script type="text/javascript" src="~/Scripts/tableexport.min.js"></script>
<style type="text/css">
    div.dataTables_wrapper div.dataTables_filter input {
        border-radius: 50px !important;
        width: 215px !important;
    }

    .comment {
        width: 100%;
        margin: 10px;
    }

    .col-sm-2 {
        width: 14.666667%;
    }

    .container {
        width: auto;
    }

    a {
        color: #0254EB
    }

        a:visited {
            color: #0254EB
        }

        a.morelink {
            text-decoration: none;
            outline: none;
        }

    .morecontent span {
        display: none;
    }

    .ui-datepicker-calendar {
        display: none;
    }

    th {
        background-color: #0096da;
        color: white;
    }

    .ui-datepicker {
        width: 180px;
        font-size: 11px;
    }
</style>
<script>
    function DateFormatter(currentdate) {
        var d = new Date(currentdate);
        var day = d.getDate();
        var month = d.getMonth() + 1;
        var year = d.getFullYear();
        if (day < 10) {
            day = "0" + day;
        }
        if (month < 10) {
            month = "0" + month;
        }
        var date = year + "-" + month + "-" + day;
        return date;
    }
    function ShowMr() {
        var showChar = 100;
        var ellipsestext = "...";
        var moretext = "more";
        var lesstext = "less";
        $('.more').each(function () {
            var content = $(this).html();
            if (content.length > showChar) {

                var c = content.substr(0, showChar);
                var h = content.substr(showChar - 1, content.length - showChar);

                var html = c + '<span class="moreellipses">' + ellipsestext + '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="" class="morelink">' + moretext + '</a></span>';

                $(this).html(html);
            }

        });

        $(".morelink").click(function () {
            if ($(this).hasClass("less")) {
                $(this).removeClass("less");
                $(this).html(moretext);
            } else {
                $(this).addClass("less");
                $(this).html(lesstext);
            }
            $(this).parent().prev().toggle();
            $(this).prev().toggle();
            return false;
        });
    }
    function ForApproval() {
       
        var a = $('#month').val();
        var b = $('#year').val();
        if (b != null && a != null) {
            var r = confirm("Period for the new entries will be locked for this month once you submit the Time Sheet.\nDo you want to continue?")
            if (r == true) {
                $('#btnsubmitApp').prop('disabled', true);
                $('#btnExportSt').prop('disabled', true);
                $.ajax({
                    type: 'POST',
                    url: '/Timesheet/TimeSheetForApproval',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(
                        {
                            'Month': a, 'Year': b
                        }),
                    dataType: 'json',
                    success: function (data) {
                        var succ = data.SuccessMsg;
                        var err = data.ErrorMsg;
                        if (succ != null && err == null) {
                            alert("TimeSheet Submit Successfully.");
                            $('#btnsubmitApp').prop('disabled', false);
                            $('#btnsubmitApp').hide();
                            $('#btnExportSt').prop('disabled', false);
                            DateWiseList();
                        }
                        else {
                            $('#btnsubmitApp').prop('disabled', false);
                            $('#btnsubmitApp').show();
                            $('#btnExportSt').prop('disabled', false);
                            alert(err);
                        }
                    },
                    error: function (data) {
                        alert(data.responseText);

                    }
                });
            }
            else {
                alert("Transaction Canceled.")
            }

        }
    }
    function search() {
       
        var year = $('#year option:selected').val();
        var month = $('#month option:selected').val();

        var a;
        $.ajax({
            url: '/TimeSheet/TimeSheetSummary',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify({ 'Month': month, 'Year': year }),
            dataType: 'json',
            success: function (response) {

               
                var table = $("#datatableList").DataTable();
                var data = response.hmlist;
                var DayData = response.ResultData;
                var remark_data = response.rmlist;
                var st, user_submission, mg_approval, hr_approval, appove_remark_manager, reject_remark_manager, approve_remark_hr, reject_remark_hr;
                var len = Object.keys(data).length;
                if (len > 0) {
                    appove_remark_manager = remark_data[0].approve_remark_manager;
                    reject_remark_manager = remark_data[0].reject_remark_manager;
                    approve_remark_hr = remark_data[0].approve_remark_hr;
                    reject_remark_hr = remark_data[0].reject_remark_hr;
                    var html = '';
                    
                    //Append each row to html table
                    for (var i = 0; i < len; i++) {

                        st = data[i].Status;
                        user_submission = data[i].submission_date;
                        mg_approval = data[i].approval_date;
                        hr_approval = data[i].hr_approval;
                        html += "<tr>";
                        html += "<td>" + data[i].ShowDate + "</td><td>" + data[i].WorkType + "</td>";
                        html += "<td>" + data[i].Customer + "</td><td>" + data[i].Project + "</td>";
                        html += "<td>" + data[i].ShowTimeFrom + "</td><td>" + data[i].ShowTimeTo + "</td>";
                        html += "<td>" + data[i].Total_Time + "</td><td><div class='comment more'>" + data[i].Details + "</div></td>";
                        if (st == "Open" || st == "Rejected" || st == "Rejected Hr") {
                            html += "<td class='text-center'>";
                            html += "<a class='btn_edit' title='Edit' data_web='" + data[i].web_entry + "' data_android='" + data[i].android_entry + "'  data_entymtd='" + data[i].entryCreation_mth + "' data_id='" + data[i].Transaction_id + "'><i class='fa fa-pencil m-r-5'></i></a>&nbsp;&nbsp;&nbsp;";
                            html += "<a class='anchorDetail' title='Delete' href='javascript:void (0);' data_entymtd='" + data[i].entryCreation_mth + "' data_id='" + data[i].Transaction_id + "'><i class='fa fa-trash m-r-5'></i></a>&nbsp;&nbsp;&nbsp;";
                            html += "<a class='btn_view' title='View' href='javascript:void (0);' data_entymtd='" + data[i].entryCreation_mth + "' data_id='" + data[i].Transaction_id + "'><i class='fa fa-eye m-r-5'></i></a>";
                            html += "</td>";
                        }
                        else {
                            html += "<td class='text-center'>";
                            html += "<a class='btn_view' title='View' href='javascript:void (0);' data_entymtd='" + data[i].entryCreation_mth + "' data_id='" + data[i].Transaction_id + "'><i class='fa fa-eye m-r-5'></i></a>";
                            html += "</td>";
                        }
                        html += "</tr>";
                        table.row.add($(html)).draw();
                  
                    }
                    $('#tab1 tbody').append(html);
                    ShowMore();
                    $('#tab1').show();
                    $('#tbl_status').show();

                    $('#btnsubmitApp').prop('disabled', false);// Temprary Add By me
                    $('#btnExportSt').prop('disabled', false);
                    $('#btnsubmitApp').show();
                    $("label[for = Lblmsg]").text(st);
                    $("label[for = Lblsubmission]").text(user_submission);
                    $("label[for = Lblapproval]").text(mg_approval);
                    $("label[for = Lblhr_approval]").text(hr_approval);
                    $("label[for = Lbl_ApproveRemark_Manager]").text(appove_remark_manager);
                    $("label[for = Lbl_RejectRemark_Manager]").text(reject_remark_manager);
                    $("label[for = Lbl_ApproveRemark_Hr]").text(approve_remark_hr);
                    $("label[for = Lbl_RejectRemark_Hr]").text(reject_remark_hr);

                    if (st != "Open" && st != undefined && st != "Rejected" && st != "Rejected Hr") {

                        $("tr td a").removeAttr('href', true);
                        $("tr td a").removeAttr('class', true);
                        //$('#btnsubmitApp').prop('disabled', true);
                        $('#btnsubmitApp').hide();
                        $("label[for = Lblmsg]").text(st);
                        $("label[for = Lblsubmission]").text(user_submission);
                        $("label[for = Lblapproval]").text(mg_approval);
                        $("label[for = Lblhr_approval]").text(hr_approval);

                        $("label[for = Lbl_ApproveRemark_Manager]").text(appove_remark_manager);
                        $("label[for = Lbl_RejectRemark_Manager]").text(reject_remark_manager);
                        $("label[for = Lbl_ApproveRemark_Hr]").text(approve_remark_hr);
                        $("label[for = Lbl_RejectRemark_Hr]").text(reject_remark_hr);
                    }
                    if (st == "Rejected") {
                        $('#btnsubmitApp').prop('disabled', false);// Temprary ADD by me
                        $("label[for = Lblmsg]").text("Revision Required.");
                        $("label[for = Lblsubmission]").text(user_submission);
                        $("label[for = Lblapproval]").text(mg_approval);
                        $("label[for = Lblhr_approval]").text(hr_approval);

                        $("label[for = Lbl_ApproveRemark_Manager]").text(appove_remark_manager);
                        $("label[for = Lbl_RejectRemark_Manager]").text(reject_remark_manager);
                        $("label[for = Lbl_ApproveRemark_Hr]").text(approve_remark_hr);
                        $("label[for = Lbl_RejectRemark_Hr]").text(reject_remark_hr);
                    }
                    if (st == "Rejected Hr") {
                        $('#btnsubmitApp').prop('disabled', false);// Temprary ADD by me
                        $("label[for = Lblmsg]").text("Revision Required(Rejected By HR).");
                        $("label[for = Lblsubmission]").text(user_submission);
                        $("label[for = Lblapproval]").text(mg_approval);
                        $("label[for = Lblhr_approval]").text(hr_approval);

                        $("label[for = Lbl_ApproveRemark_Manager]").text(appove_remark_manager);
                        $("label[for = Lbl_RejectRemark_Manager]").text(reject_remark_manager);
                        $("label[for = Lbl_ApproveRemark_Hr]").text(approve_remark_hr);
                        $("label[for = Lbl_RejectRemark_Hr]").text(reject_remark_hr);
                    }

                    var da = JSON.parse(DayData);
                    var jsonResultData = ConvertJsonToTable(da, null, 'table table- striped table- bordered table- hover table- condensed table- responsive', null);
                    $("#resultList").html(jsonResultData);
                    $('#divdayhours').show();
                }
                else {
                    $('#btnsubmitApp').html("Submit For Approval");
                    $('#btnsubmitApp').prop('disabled', true);
                    $('#btnExportSt').prop('disabled', true);
                    $("label[for = Lblmsg]").text("No Any Data.");
                    $('#tab1').hide();
                    $('#btnsubmitApp').show();
                    $('#tbl_status').hide();
                    $('#divdayhours').hide();
                    alert("No Data Found..");
                }

            },
            error: function () {
                alert("");
            }
        });
    }
    function ShowMore() {
        var showChar = 100;
        var ellipsestext = "...";
        var moretext = "more";
        var lesstext = "less";
        $('.more').each(function () {
            var content = $(this).html();
            if (content.length > showChar) {

                var c = content.substr(0, showChar);
                var h = content.substr(showChar - 1, content.length - showChar);

                var html = c + '<span class="moreellipses">' + ellipsestext + '&nbsp;</span><span class="morecontent"><span>' + h + '</span>&nbsp;&nbsp;<a href="" class="morelink">' + moretext + '</a></span>';

                $(this).html(html);
            }

        });

        $(".morelink").click(function () {
            if ($(this).hasClass("less")) {
                $(this).removeClass("less");
                $(this).html(moretext);
            } else {
                $(this).addClass("less");
                $(this).html(lesstext);
            }
            $(this).parent().prev().toggle();
            $(this).prev().toggle();
            return false;
        });
    }
    function DateWiseList() {
        var a = $('#month').val();
        var b = $('#year').val();
        $.ajax({
            url: '/Timesheet/DateWiseSummary',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            data: JSON.stringify(
                {
                    'Month': a, 'Year': b
                }),
            dataType: 'json',
            success: function (response) {
                var data = response.hmlist;
                var DayData = response.ResultData;
                var remark_data = response.rmlist;
                var st, user_submission, mg_approval, hr_approval, appove_remark_manager, reject_remark_manager, approve_remark_hr, reject_remark_hr;
                var len = Object.keys(data).length;
                if (len > 0) {
                    $('#tab1 tbody').empty();

                    appove_remark_manager = remark_data[0].approve_remark_manager;
                    reject_remark_manager = remark_data[0].reject_remark_manager;
                    approve_remark_hr = remark_data[0].approve_remark_hr;
                    reject_remark_hr = remark_data[0].reject_remark_hr;

                    var html = '';
                    //Append each row to html table
                    for (var i = 0; i < len; i++) {
                        st = data[i].Status;
                        user_submission = data[i].submission_date;
                        mg_approval = data[i].approval_date;
                        hr_approval = data[i].hr_approval;
                        html += "<tr>";
                        html += "<td>" + data[i].ShowDate + "</td><td>" + data[i].WorkType + "</td>";
                        html += "<td>" + data[i].Customer + "</td><td>" + data[i].Project + "</td>";
                        html += "<td>" + data[i].ShowTimeFrom + "</td><td>" + data[i].ShowTimeTo + "</td>";
                        html += "<td>" + data[i].Total_Time + "</td><td><div class='comment more'>" + data[i].Details + "</div></td>";
                        //html += "<td><a class='btn_edit' href='/Home/EditSheetSummary/" + data[i].Transaction_id + "'>Edit</a></td>";
                        //html += "<td><a class='anchorDetail' href='javascript:void (0);' data_id='" + data[i].Transaction_id + "'>Delete</a></td>";
                        if (st == "Open" || st == "Rejected" || st == "Rejected Hr") {
                            html += "<td class='text-center'>";
                            html += "<a class='btn_edit' title='Edit' data_web='" + data[i].web_entry + "' data_android='" + data[i].android_entry + "'  data_entymtd='" + data[i].entryCreation_mth + "' data_id='" + data[i].Transaction_id + "' href='/Home/EditSheetSummary/" + data[i].Transaction_id + "'><i class='fa fa-pencil m-r-5'></i></a>&nbsp;&nbsp;&nbsp;";
                            html += "<a class='anchorDetail' title='Delete' href='javascript:void (0);' data_entymtd='" + data[i].entryCreation_mth + "' data_id='" + data[i].Transaction_id + "'><i class='fa fa-trash m-r-5'></i></a>&nbsp;&nbsp;&nbsp;";
                            html += "<a class='btn_view' title='View' href='javascript:void (0);' data_entymtd='" + data[i].entryCreation_mth + "' data_id='" + data[i].Transaction_id + "'><i class='fa fa-eye m-r-5'></i></a>";
                            html += "</td>";
                        }
                        else {
                            html += "<td class='text-center'>";
                            html += "<a class='btn_view' title='View' href='javascript:void (0);' data_entymtd='" + data[i].entryCreation_mth + "' data_id='" + data[i].Transaction_id + "'><i class='fa fa-eye m-r-5'></i></a>";
                            html += "</td>";
                        }
                        html += "</tr>";

                    }
                    $('#tab1 tbody').append(html);
                    ShowMr();
                    $('#tab1').show();

                    $("label[for = Lblmsg]").text(st);
                    $("label[for = Lblsubmission]").text(user_submission);
                    $("label[for = Lblapproval]").text(mg_approval);
                    $("label[for = Lblhr_approval]").text(hr_approval);

                    $("label[for = Lbl_ApproveRemark_Manager]").text(appove_remark_manager);
                    $("label[for = Lbl_RejectRemark_Manager]").text(reject_remark_manager);
                    $("label[for = Lbl_ApproveRemark_Hr]").text(approve_remark_hr);
                    $("label[for = Lbl_RejectRemark_Hr]").text(reject_remark_hr);

                    if (st != "Open" && st != undefined && st != "Rejected" && st != "Rejected Hr") {
                        $("tr td a").removeAttr('href', true);
                        $("tr td a").removeAttr('class', true);
                        //$('#btnsubmitApp').prop('disabled', true);
                        $('#btnsubmitApp').hide();
                        $("label[for = Lblmsg]").text(st);
                        $("label[for = Lblsubmission]").text(user_submission);
                        $("label[for = Lblapproval]").text(mg_approval);
                        $("label[for = Lblhr_approval]").text(hr_approval);

                        $("label[for = Lbl_ApproveRemark_Manager]").text(appove_remark_manager);
                        $("label[for = Lbl_RejectRemark_Manager]").text(reject_remark_manager);
                        $("label[for = Lbl_ApproveRemark_Hr]").text(approve_remark_hr);
                        $("label[for = Lbl_RejectRemark_Hr]").text(reject_remark_hr);
                    }
                    if (st == "Rejected") {
                        $('#btnsubmitApp').show();
                        $('#btnsubmitApp').prop('disabled', false);
                        //$('#btnsubmitApp').html("Revision Required...");
                        $("label[for = Lblmsg]").text("Revision Required.");
                        $("label[for = Lblsubmission]").text(user_submission);
                        $("label[for = Lblapproval]").text(mg_approval);
                        $("label[for = Lblhr_approval]").text(hr_approval);

                        $("label[for = Lbl_ApproveRemark_Manager]").text(appove_remark_manager);
                        $("label[for = Lbl_RejectRemark_Manager]").text(reject_remark_manager);
                        $("label[for = Lbl_ApproveRemark_Hr]").text(approve_remark_hr);
                        $("label[for = Lbl_RejectRemark_Hr]").text(reject_remark_hr);
                    }
                    if (st == "Rejected Hr") {
                        $('#btnsubmitApp').show();
                        $('#btnsubmitApp').prop('disabled', false);
                        //$('#btnsubmitApp').html("Revision Required...");
                        $("label[for = Lblmsg]").text("Revision Required(Rejected By HR).");
                        $("label[for = Lblsubmission]").text(user_submission);
                        $("label[for = Lblapproval]").text(mg_approval);
                        $("label[for = Lblhr_approval]").text(hr_approval);

                        $("label[for = Lbl_ApproveRemark_Manager]").text(appove_remark_manager);
                        $("label[for = Lbl_RejectRemark_Manager]").text(reject_remark_manager);
                        $("label[for = Lbl_ApproveRemark_Hr]").text(approve_remark_hr);
                        $("label[for = Lbl_RejectRemark_Hr]").text(reject_remark_hr);
                    }
                    var da = JSON.parse(DayData);
                    var jsonResultData = ConvertJsonToTable(da, null, 'table table- striped table- bordered table- hover table- condensed table- responsive', null);
                    $("#resultList").html(jsonResultData);
                    $('#divdayhours').show();
                }
                else {
                    $('#btnsubmitApp').html("Submit For Approval");
                    $('#btnsubmitApp').prop('disabled', true);
                    $('#btnExportSt').prop('disabled', true);
                    $("label[for = Lblmsg]").text("No Any Data.");
                    $('#tab1').hide();
                    $('#tbl_status').hide();
                    $('#divdayhours').hide();
                    //alert("No Data Found..");
                }
            },
            error: function () {
                alert("");
            }
        });
    }
    function UpdateData() {
       
        var dt = $('#PostingDate').val();
        var proj = $('#Project option:selected').text();
        var project_id = $('#Project option:selected').val();
        var customer = $('#Customer option:selected').text();
        var customer_id = $('#Customer option:selected').val();
        var worktype = $('#WorkType option:selected').text();
        var worktype_id = $('#WorkType option:selected').val();
        var time_from = $('#time_from').val();
        var time_to = $('#time_to').val();
        var detail = $('#Details').val();
        var ID = $('#hdn_id').val();
        var currt = new Date;
        var currentdate = DateFormatter(currt);
        if (ID != "")
        {
            if (worktype_id != 5 && worktype_id != 6 && worktype_id != 7) {
                if (dt <= currentdate) {
                    if (dt != "" && proj != "Select" && time_from != "" && time_to != "" && detail != "" && worktype != "Select" && customer != "Select") {
                        $.ajax({
                            url: '/Timesheet/UpdateMainPage',
                            type: 'POST',
                            contentType: "application/json; charset=utf-8",
                            data: JSON.stringify(
                                {
                                    'Date': dt, 'WorkType_id': worktype_id, 'Project_id': project_id, 'Time_from': time_from,
                                    'Time_to': time_to, 'Description': detail, 'Customer_id': customer_id, 'ID': ID
                                }),
                            dataType: 'json',
                            success: function (data) {
                               
                                var a = data.SuccessMsg;
                                var b = data.ErrorMsg;
                                if (data != null && a != null) {
                                    alert(a);
                                    //ClearText();
                                    //SheetCancelOnClick();
                                }
                                else {
                                    alertify.alert(b);
                                }
                            },
                            error: function () {
                                alert("");
                            }
                        });
                    }
                    else if (dt == "") {
                        alert("Please Check Date...");
                        setTimeout(function () { $('#ShowDate').focus(); }, 1);
                    }
                    else if (worktype == "Select") {
                        alert("Please Select Work Type...");
                        setTimeout(function () { $('#WorkType_id').focus(); }, 1);
                    }
                    else if (customer == "Select") {
                        alert("Please Select Customer...");
                        setTimeout(function () { $('#Customer_id').focus(); }, 1);
                    }
                    else if (proj == "Select") {
                        alert("Please Choose At Least One Project...");
                        setTimeout(function () { $('#Project_id').focus(); }, 1);
                    }
                    else if (time_from == "") {
                        alert("Please Enter The Hours & Minutes...");
                        setTimeout(function () { $('#ShowTimeFrom').focus(); }, 1);
                    }
                    else if (time_to == "") {
                        alert("Please Enter The Hours & Minutes...");
                        setTimeout(function () { $('#ShowTimeTo').focus(); }, 1);
                    }
                    else if (detail == "") {
                        alert("Please Enter The Details...");
                        setTimeout(function () { $('#Details').focus(); }, 1);
                    }
                }
                else
                {
                    alert("Time Sheet Entry Date Can't Greater Then Current Date.");
                    setTimeout(function () { $('#PostingDate').focus(); }, 1);
                }
            }
            else {
                alert('You Already have an entry as Workday on same date.\nYou Can not Update Workday entry to ' + worktype + ' entry.')
            }
        }
        
    }
</script>
<script>
    $(document).ready(function () {
        $('ul.list-unstyled  li a[href$="' + "/Timesheet_History" + '"]').addClass('active');
        var currentTime = new Date()
        var minDate = new Date(currentTime.getFullYear(), currentTime.getMonth() - 1);
        var mindates = new Date(currentTime.getFullYear(), currentTime.getMonth(), currentTime.getDate() - 8);
        $("#PostingDate").datepicker({ dateFormat: "yy-mm-dd", maxDate: "+0m +0w", minDate: minDate, firstDay: 1 }).datepicker('setDate', 'today').attr('readonly', true);
        $("#ShowDate").datepicker({ dateFormat: "yy-mm-dd", maxDate: "+0m +0w", minDate: minDate, firstDay: 1 }).datepicker('setDate', '1').attr('readonly', true);
        var dt = $("#PostingDate").val();
        $('#time_from').datetimepicker({ weekStart: 1, clearBtn: 1, autoclose: 1, todayHighlight: 1, startView: 1, forceParse: 0, showMeridian: 1, maxView: 1, startDate: new Date(dt + " 00:00"), endDate: new Date(dt + " 23:59") });

        $('#time_to').datetimepicker({ weekStart: 1, clearBtn: 1, autoclose: 1, todayHighlight: 1, startView: 1, forceParse: 0, showMeridian: 1, maxView: 1, startDate: new Date(dt + " 00:00"), endDate: new Date(dt + " 23:59") });
        var minOffset = -1, maxOffset = 2;
        var thisYear = new Date().getFullYear();
        var select = $('#year');
        for (var i = 0; i <= maxOffset; i++) {
            var year = thisYear - i;
            $('<option>', { value: year, text: year }).appendTo(select);
        }
        $('#Customer').on('change', function () {
            var customer_id = $('#Customer').val();
            $.ajax({
                url: '/TimeSheet/GetProjectList',
                type: 'POST',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(
                    {
                        'Customer_Id': customer_id
                    }),
                dataType: 'json',
                success: function (data) {
                    var b = data.ErrorMsg;
                    if (data != null) {
                        var len = Object.keys(data).length;
                        $("#Project").html("");
                        $("#Project").append($('<option></option>').html("Select"))
                        //Append each row to dropdown
                        for (var i = 0; i < len; i++) {

                            $("#Project").append($('<option></option>').val(data[i].Project_id).html(data[i].Project_Name))
                        }
                        setTimeout(function () { $('#Project').focus(); }, 1);
                    }
                    else {
                        alertify.alert(b);
                    }
                },
                error: function () {
                    alert("");
                }
            });
        })
        $("#datatableList").DataTable();
        $(document).on('click', '.btn_edit', function (e) {
           
            var timesheet_id = $(this).attr('data_id');
            if (timesheet_id != "") {
                $.ajax({
                    type: 'POST',
                    url: '/Timesheet/GetTimeSheetEdit',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(
                        {
                            'Timesheet_id': timesheet_id
                        }),
                    datatype: JSON,
                    success: function (data) {
                       
                        var result = JSON.parse(data);
                        $.each(result, function (txt, val) {
                            $('#PostingDate').val(val.TIMESHEET_DATE);
                            $('#WorkType').val(val.WORK_TYPE_ID);
                            $('#Customer').val(val.CUSTOMER_ID);
                            $('#Project').val(val.PROJECT_ID);
                            $('#time_from').val(val.TIME_FROM);
                            $('#time_to').val(val.TIME_TO);
                            $('#Details').val(val.DESCRIPTION);
                            $('#hdn_id').val(val.ID);
                            });
                            $('#edit_Timesheet').modal('show');
                        $('#btn_edit_closeTIMESHEET').on('click', function () {
                            $('#edit_Timesheet').modal('hide');
                        });
                    }
                });
            }

        });
        $(document).on('click', '.btn_view', function (e) {
            var timesheet_id = $(this).attr('data_id');
            if (timesheet_id != "") {
                $.ajax({
                    type: 'POST',
                    url: '/Timesheet/GetTimeSheet',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(
                        {
                            'Timesheet_id': timesheet_id
                        }),
                    dataType: 'json',
                    success: function (data) {
                       
                        if (data != null) {
                            $('#txt_date').val(data[0].ShowDate);
                            $('#txt_worktype').val(data[0].WorkType);
                            $('#txt_customer').val(data[0].Customer);
                            $('#txt_project').val(data[0].Project);
                            $('#txt_timefrom').val(data[0].ShowTimeFrom);
                            $('#txt_timeto').val(data[0].ShowTimeTo);
                            $('#txt_description').val(data[0].Details);
                            $('#view_timesheet').modal('show');
                        }
                    },
                    error: function (data) {
                        alert(data.responseText);
                    }
                });
            }

        });
        $(document).on('click', ".anchorDetail", function (e) {
            var $buttonClicked = $(this);
            var id = $buttonClicked.attr("data_id");
            var entry_mtd = $buttonClicked.attr("data_entymtd");
            if (entry_mtd != -1) {
                var c = confirm("Once Deleted you can't recover the data.\nDo you want to continue?")
                if (c == true) {
                    $.ajax({
                        type: 'POST',
                        url: '/Timesheet/DelTimeSheetRecord',
                        contentType: "application/json; charset=utf-8",
                        data: JSON.stringify(
                            {
                                'transaction_id': id
                            }),
                        dataType: 'json',
                        success: function (data) {
                            var succ = data.SuccessMsg;
                            var err = data.ErrorMsg;
                            if (succ != null && err == null) {
                                alert("Entry Sucessfully Deleted.");
                                //$('#btnsubmitApp').prop('disabled', true);
                                //$('#btnsubmitApp').hide();
                                DateWiseList();
                            }
                            else {
                                alert(err);
                            }
                        },
                        error: function () {

                        }
                    });
                }
                else {
                    alert("Transaction Canceled.")
                }
            }
            else {
                alertify.alert('This is a System generated entry and changes to this record are not allowed.').setHeader('<em> Message </em> ');
            }

        });
        var XLSbutton = document.getElementById('btnExportSt');
        XLSbutton.addEventListener('click', function (e) {
            var ExportButtons = document.getElementById('datatableList');
            var dt = $('#year').val();
            var months = {
                '01': 'Jan', '02': 'Feb', '03': 'Mar', '04': 'Apr', '05': "May", '06': 'Jun',
                '07': 'Jul', '08': 'Aug', '09': 'Sep', '10': 'Oct', '11': 'Nov', '12': 'Dec'
            };
            var selectedMonthName = months[dt[0]];
            var instance = new TableExport(ExportButtons, {
                headers: true,                              // (Boolean), display table headers (th or td elements) in the <thead>, (default: true)
                footers: true,                              // (Boolean), display table footers (th or td elements) in the <tfoot>, (default: false)
                formats: ['csv'],                           // (String[]), filetype(s) for the export, (default: ['xls', 'csv', 'txt'])
                filename: 'TimeSheet-' + selectedMonthName + '' + dt[1],                             // (id, String), filename for the downloaded file, (default: 'id')
                bootstrap: false,                           // (Boolean), style buttons using bootstrap, (default: true)
                exportButtons: false,                        // (Boolean), automatically generate the built-in export buttons for each of the specified formats (default: true)
                position: 'bottom',                         // (top, bottom), position of the caption element relative to table, (default: 'bottom')
                ignoreRows: null,                           // (Number, Number[]), row indices to exclude from the exported file(s) (default: null)
                ignoreCols: [8, 9],                           // (Number, Number[]), column indices to exclude from the exported file(s) (default: null)
                trimWhitespace: true
            });

            // "id" of selector    // format
            var exportData = instance.getExportData()['datatableList']['csv'];
            instance.export2file(exportData.data, exportData.mimeType, exportData.filename, exportData.fileExtension);
        });

    })
</script>
<div class="container">
    <br />
    <div class="panel panel-default">
        <div class="panel-heading">Summary Details</div>
        <br />
        <div class="row">
            <div class="col-sm-12">
                <form class="form-horizontal">
                    <div class="form-group" style="margin-left:15px;margin-right:15px;">
                        <label class="control-label col-sm-1" id="as">Year:</label>
                        <div class="col-sm-2">
                            <select name="year" id="year" style="height:30px; border-radius:18px; width:100%;">
                                <option value="">Select Year</option>
                            </select>

                        </div>
                        <div class="col-sm-2">
                            <select name="month" id="month" style="height:30px; border-radius: 18px;width: 100%;">
                                <option value="0">Select Month </option>
                                <option value="1">Jan</option>
                                <option value="2">Feb</option>
                                <option value="3">Mar</option>
                                <option value="4">Apr</option>
                                <option value="5">May</option>
                                <option value="6">Jun</option>
                                <option value="7">Jul</option>
                                <option value="8">Aug</option>
                                <option value="9">Sep</option>
                                <option value="10">Oct</option>
                                <option value="11">Nov</option>
                                <option value="12">Dec</option>
                            </select>
                        </div>

                        <div class="col-sm-2">
                            <button type='button' style="padding:6px 8px;border-radius:18px;" id='btnsearch' class="btn btn-primary" onclick="search();">Search</button>
                        </div>
                        <div class="col-sm-2">
                            <button type='button' style="padding:6px 8px;border-radius:18px; margin-left: -50px;" id='btnsubmitApp' class="btn btn-primary" onclick="ForApproval();">Submit For Approval</button>
                        </div>
                        <div class="col-sm-2">
                            <button type='button' style=" padding:6px 8px ; border-radius:18px;" id='btnExportSt' class="btn btn-primary">Export To Csv</button>
                        </div>
                        @*<label class="control-label col-sm-1"></label>*@
                        @*<div class="col-sm-5">
                                <table class="table table-responsive table-bordered" id="tbl_status" style="font-size:11px;">
                                    <thead>
                                        <tr>
                                            <th>TimeSheet Status</th>
                                            <th>Submission Date</th>
                                            <th>Approval Date</th>
                                            <th>HR Approval</th>
                                            <th>TimeSheet Status</th>
                                            <th>Submission Date</th>
                                            <th>Approval Date</th>
                                            <th>HR Approval</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>@Html.Label("Lblmsg", "No Any Data.", new { style = "color:#ff0000" })</td>
                                            <td>@Html.Label("Lblsubmission", "No Data.", new { style = "color:#ff0000" })</td>
                                            <td>@Html.Label("Lblapproval", "No Data.", new { style = "color:#ff0000" })</td>
                                            <td>@Html.Label("Lblhr_approval", "No Data.", new { style = "color:#ff0000" })</td>
                                            <td>@Html.Label("Lblmsg", "No Any Data.", new { style = "color:#ff0000" })</td>
                                            <td>@Html.Label("Lblsubmission", "No Data.", new { style = "color:#ff0000" })</td>
                                            <td>@Html.Label("Lblapproval", "No Data.", new { style = "color:#ff0000" })</td>
                                            <td>@Html.Label("Lblhr_approval", "No Data.", new { style = "color:#ff0000" })</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>*@
                    </div>
                </form>
            </div>
        </div>
        <div class="panel-body" style="margin-top:-16px;">
            <table class="table table-responsive table-bordered" id="tbl_status" style="font-size:11px;">
                <thead>
                    <tr>
                        <th>TimeSheet Status</th>
                        <th>Submission Date</th>
                        <th>Approval Date</th>
                        <th>HR Approval</th>
                        <th>Approve Remark Manager</th>
                        <th>Reject Remark Manager</th>
                        <th>Approve Remark HR</th>
                        <th>Reject Remark HR</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>@Html.Label("Lblmsg", "No Any Data.", new { style = "color:#ff0000" })</td>
                        <td>@Html.Label("Lblsubmission", "No Data.", new { style = "color:#ff0000" })</td>
                        <td>@Html.Label("Lblapproval", "No Data.", new { style = "color:#ff0000" })</td>
                        <td>@Html.Label("Lblhr_approval", "No Data.", new { style = "color:#ff0000" })</td>
                        <td>@Html.Label("Lbl_ApproveRemark_Manager", "No Any Data.", new { style = "color:#ff0000" })</td>
                        <td>@Html.Label("Lbl_RejectRemark_Manager", "No Data.", new { style = "color:#ff0000" })</td>
                        <td>@Html.Label("Lbl_ApproveRemark_Hr", "No Data.", new { style = "color:#ff0000" })</td>
                        <td>@Html.Label("Lbl_RejectRemark_Hr", "No Data.", new { style = "color:#ff0000" })</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="panel-body" id="tab1" style="margin-top:-41px;">
            <table class="table table-striped table-bordered table-hover table-condensed" id="datatableList" style="font-size:11px;">
                <thead>
                    <tr>
                        <th>TimeSheet Date</th>
                        <th>Work Type</th>
                        <th>Customer Name</th>
                        <th>Project Name</th>
                        <th>Time From</th>
                        <th>Time To</th>
                        <th>Total Time</th>
                        <th>Description</th>
                        <th style="width:80px;">Action</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    <div class="panel panel-default" id="divdayhours">
        <div class="panel panel-heading">Day Total Hours</div>
        <div class="panel-body">
            <div id="resultList"></div>
        </div>
    </div>
</div>

<div id="view_timesheet" class="modal custom-modal fade" role="dialog" style="top:76px;left:0px;background-image: none;">
    <div class="modal-dialog" style="width:100%;background-image: none;">
        <button type="button" class="close" id="btn_viewClose" data-dismiss="modal">&times;</button>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h4 class="modal-title">View Timesheet</h4>
            </div>
            <div class="modal-body">
                <form class="m-b-30">
                    <div class="panel" id="pnl_header">
                        <div class="panel-heading" style="background-color:#00bff9;">Header</div>
                        <div class="panel-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label class="control-label" for="PostingDate">Date:<span class="required">*</span></label>

                                                <input class="form-control" readonly="readonly" id="txt_date" type="text">

                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label class="control-label " for="Project">Work Type:<span class="required">*</span></label>

                                                <input class="form-control" id="txt_worktype" type="text" readonly="readonly">

                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label class="control-label col-md-3" for="Project">Customer:<span class="required">*</span></label>

                                                <input class="form-control" readonly="readonly" id="txt_customer" type="text">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label class="control-label col-md-3" for="Project">Project:<span class="required">*</span></label>
                                                <input class="form-control" readonly="readonly" id="txt_project" type="text">

                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <div class="row">
                                                    <label class="control-label col-md-3" for="Time">Time:<span class="required">*</span></label>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <input class="form-control" readonly="readonly" id="txt_timefrom" type="text">
                                                    </div>
                                                    <div class="col-md-6">
                                                        <input class="form-control" readonly="readonly" id="txt_timeto" type="text">
                                                    </div>

                                                </div>

                                            </div>
                                        </div>

                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <div class="col-md-6">
                                                    <label class="control-label col-md-3" for="Details">Description:<span class="required">*</span></label>

                                                </div>

                                                <div class="col-md-9">
                                                    <textarea type="text" id="txt_description" readonly="readonly" class="form-control"></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<div id="Timesheet_Update_view" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog">
        <button type="button" id="btn_edit_close" class="close">&times;</button>
        <div class="modal-content modal-lg">

            <div class="panel" id="pnl_header">
                <div class="panel-body">
                    <div class="modal-header"><h4 class="modal-title">Update Sheet Card</h4></div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="edit_Timesheet" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog">
        <button type="button" id="btn_edit_closeTIMESHEET" class="close">&times;</button>
        <div class="modal-content modal-lg">
            <div class="modal-header"><h4 class="modal-title">Edit Expense</h4></div>
            <div class="modal-body">
                <form>
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label" for="PostingDate">Date:<span class="required">*</span></label>

                                <input type="text" class="form-control" id="PostingDate" maxlength="11" onchange="MainDateCheck();" tabindex="1" readonly>

                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label " for="Project">Work Type:<span class="required">*</span></label>

                                @Html.DropDownList("WorkType", (IEnumerable<SelectListItem>)ViewBag.worklist, "Select", new { @class = "form-control", @tabindex = "2" })

                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label col-md-3" for="Project">Customer:<span class="required">*</span></label>

                                @Html.DropDownList("Customer", (IEnumerable<SelectListItem>)ViewBag.Customerlist, "Select", new { @class = "form-control", @tabindex = "3" })

                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label class="control-label col-md-3" for="Project">Project:<span class="required">*</span></label>
                                @Html.DropDownList("Project", (IEnumerable<SelectListItem>)ViewBag.projectlist, "Select", new { @class = "form-control", @tabindex = "4" })

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <div class="row">
                                    <label class="control-label col-md-3" for="Time">Time:<span class="required">*</span></label>
                                </div>
                                <div class="row">
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="time_from" onchange="CheckDate();" tabindex="5" autocomplete="off">From
                                    </div>
                                    <div class="col-md-6">
                                        <input type="text" class="form-control" id="time_to" onchange="CheckDateTime();" tabindex="6" autocomplete="off">To
                                    </div>

                                </div>

                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <div class="col-md-6">
                                    <label class="control-label col-md-3" for="Details">Description:<span class="required">*</span></label>

                                </div>

                                <div class="col-md-9">
                                    <textarea type="text" class="form-control" id="Details" rows="4" maxlength="500" tabindex="7" autocomplete="off"></textarea>
                                </div>
                            </div>
                        </div>
                       
                    </div>

                    <div class="text-center">
                        
                        <input type="hidden" id="hdn_id" />
                        <button type="button" id="btn_Update" class="btn btn-primary" onclick="UpdateData()">Update </button>
                    </div>
                </form>
            </div>
        </div>
    </div>


</div>
