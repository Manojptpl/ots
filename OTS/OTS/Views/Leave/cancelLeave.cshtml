@using System.Data;
<style>
    @@media (min-width: 992px) {
        .modal-lg-leaveBal {
            width: 1038px !important;
        }
    }
    h2 {
        font-size: 20px !important;
    }
    @@media (min-width: 768px) {
        .lead {
            font-size: 15px;
        }
    }
    .sweet-alert {
        width: 402px !important;
    }   
</style>
 
<script>
    $(document).ready(function () {
        $('ul.list-unstyled  li a[href$="' + "/cancelLeave" + '"]').addClass('active');
        var currentTime = new Date();
        var year = currentTime.getFullYear();
        $("#ddl_year").val(year);
        var role_id = $('#hdn_roleId').val();
        var manager_id = $('#hdn_managerId').val();
        if (role_id == 2) {
            //  $("#div_leavebalance").css("visibility", "visible");
            $("#div_leavebalance").css("display", "block");
            $("#ddlemployeeapplce").prop("disabled", false);

        } else {
            //  $("#div_leavebalance").css("visibility", "hidden");
            $("#div_leavebalance").css("display", "none");
            $("#ddlemployeeapplce").prop("disabled", true);
        }
        var table1 = $(".tbl_leavebalance").DataTable(
            {
                //"columnDefs": [
                //    { "targets": [7], "orderable": false }
                //],
                "bLengthChange": false,
                "searching": false,
                "language": {
                    "search": "",
                    "searchPlaceholder": "Search"
                },
                "order": [[0, 'asc']]
            }
        );

        if (@ViewBag.event_permission.Export == 1) {
            var buttons = new $.fn.dataTable.Buttons(table1, {
                buttons: [
                    {
                        extend: 'excelHtml5',
                        text: '<i class="fa fa-file-excel-o fa-lg"></i>  ',
                        title: 'Leave Balance sheet',
                        titleAttr: 'Excel'
                    },
                    {
                        extend: 'csvHtml5',
                        text: '<i class="fa fa-file-text-o fa-lg"></i>  ',
                        title: 'Leave Balance sheet',
                        titleAttr: 'CSV'
                    },
                    {
                        extend: 'pdfHtml5',
                        text: '<i class="fa fa-file-pdf-o fa-lg"></i>  ',
                        title: 'Leave Balance sheet',
                        titleAttr: 'PDF'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fa fa-print fa-lg"></i>  ',
                        title: 'Leave Balance sheet',
                        titleAttr: 'Print'
                    }
                ]
            }).container().appendTo($('#buttonsleavebalance'));
        }
        //LeaveBalance(table1);

        $("#btn_leave_balance_show").on("click", function () {
            if ($('#hdn_roleId').val() == 2) {
                $("input[name='leaveoptradio'][value='Self']").prop("checked", true);
            }
            LeaveBalance(table1);

        });
        $("#btn_search").on("click", function () {
            //if ($("#ddl_year").val() == 0) {
            //    alert('Please Select Year !');
            //    table1.clear().draw();
            //    return false;
            //}
            //if ($('#hdn_roleId').val() == 2) {

            //    $("input[name='leaveoptradio'][value='Self']").prop("checked", true);
            //}

            //LeaveBalance(table1);

         
            if ($("#ddl_year").val() == 0) {
                alert('Please Select Year !');

                return false;
            }
            if ($("input[name='leaveoptradio'][value='Self']").is(":checked") == true) {
                table1.rows().remove().draw();
                LeaveBalance(table1);
            } else if ($("input[name='leaveoptradio'][value='Subordinate']").is(":checked") == true) {
                table1.rows().remove().draw();
                $.ajax({
                    type: 'POST',
                    url: '/leave/leavebalanceshowmanager',
                    data: JSON.stringify({ 'year': $("#ddl_year").val() }),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        var mydata = JSON.parse(data.msg);
                        table1.rows().remove().draw();
                        for (var i = 0; i < mydata.length; i++) {
                            var markup = "";
                            markup += "<tr id='row" + i + "'>";
                            markup += "<td> " + (parseInt(i) + 1) + "</td > ";
                            markup += "<td> " + mydata[i].EMPLOYEE_NAME + "</td > ";
                            markup += "<td> " + mydata[i].LEAVE_TYPE + "</td > ";
                            markup += "<td> " + mydata[i].OPENING_BAL + "</td > ";
                            markup += "<td> " + mydata[i].CURRENT_ENTITLEMENT + "</td > ";
                            markup += "<td> " + mydata[i].LEAVES_AVAILED + "</td > ";
                            //markup += "<td> " + mydata[i].ADJESTMENT_DAYS + "</td > ";
                            markup += "<td> " + mydata[i].CLOSING_BAL + "</td > ";
                            markup += "</tr>";
                            table1.row.add($(markup)).draw();
                        }
                    }

                });

            }


        });

        $("#ddl_year").on("change", function () {
            //$("input[name='leaveoptradio']:checked").prop("checked", false);
            $("input[name='leaveoptradio'][value='Self']").prop("checked", true);
            table1.rows().remove().draw();
            if ($("#ddl_year").val() == 0) {
                alert('Please Select Year !');
                return false;
            }
            LeaveBalance(table1);
        });

        $("input[name='leaveoptradio']").click(function () {
            //if ($("#ddl_year").val() == 0) {
            //    alert('Please Select Year !');
            //    table1.clear().draw();
            //    return false;
            //}
            //if ($(this).val() == "Self") {

            //    LeaveBalance(table1);
            //} else {

            //    $.ajax({
            //        type: 'POST',
            //        url: '/leave/leavebalanceshowmanager',
            //        data: JSON.stringify({ 'year': $("#ddl_year").val() }),
            //        contentType: 'application/json;charset=utf-8',
            //        dataType: 'json',
            //        success: function (data) {
            //            var mydata = JSON.parse(data.msg);
            //            table1.clear().draw();
            //            for (var i = 0; i < mydata.length; i++) {
            //                var markup = "";
            //                markup += "<tr id='row" + i + "'>";
            //                markup += "<td> " + (parseInt(i) + 1) + "</td > ";
            //                markup += "<td> " + mydata[i].EMPLOYEE_NAME + "</td > ";
            //                markup += "<td> " + mydata[i].LEAVE_TYPE + "</td > ";
            //                markup += "<td> " + mydata[i].OPENING_BAL + "</td > ";
            //                markup += "<td> " + mydata[i].CURRENT_ENTITLEMENT + "</td > ";
            //                markup += "<td> " + mydata[i].LEAVES_AVAILED + "</td > ";
            //                markup += "<td> " + mydata[i].ADJESTMENT_DAYS + "</td > ";
            //                markup += "<td> " + mydata[i].CLOSING_BAL + "</td > ";
            //                markup += "</tr>";
            //                table1.row.add($(markup)).draw();
            //            }
            //        }

            //    });

            table1.rows().remove().draw();
            if ($("#ddl_year").val() == 0) {
                alert('Please Select Year !');

                return false;
            }
            if ($("input[name='leaveoptradio'][value='Self']").is(":checked") == true) {
                LeaveBalance(table1);
            } else if ($("input[name='leaveoptradio'][value='Subordinate']").is(":checked") == true) {

                $.ajax({
                    type: 'POST',
                    url: '/leave/leavebalanceshowmanager',
                    data: JSON.stringify({ 'year': $("#ddl_year").val() }),
                    contentType: 'application/json;charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        var mydata = JSON.parse(data.msg);
                        table1.rows().remove().draw();
                        for (var i = 0; i < mydata.length; i++) {
                            var markup = "";
                            markup += "<tr id='row" + i + "'>";
                            markup += "<td> " + (parseInt(i) + 1) + "</td > ";
                            markup += "<td> " + mydata[i].EMPLOYEE_NAME + "</td > ";
                            markup += "<td> " + mydata[i].LEAVE_TYPE + "</td > ";
                            markup += "<td> " + mydata[i].OPENING_BAL + "</td > ";
                            markup += "<td> " + mydata[i].CURRENT_ENTITLEMENT + "</td > ";
                            markup += "<td> " + mydata[i].LEAVES_AVAILED + "</td > ";
                            //markup += "<td> " + mydata[i].ADJESTMENT_DAYS + "</td > ";
                            markup += "<td> " + mydata[i].CLOSING_BAL + "</td > ";
                            markup += "</tr>";
                            table1.row.add($(markup)).draw();
                        }
                    }

                });

        //    }
        //});


            }
        });
        var table = $(".tbl_leavecancelhistory").DataTable(
            {
                "columnDefs": [
                    { "targets": [7], "orderable": false }
                ],
                "language": {
                    "search": "",
                    "searchPlaceholder": "Search"
                },
                "order": [[0, 'asc']]
            }
        );
        if (@ViewBag.event_permission.Export == 1) {
            var buttons = new $.fn.dataTable.Buttons(table, {
                buttons: [
                    {
                        extend: 'excelHtml5',
                        text: '<i class="fa fa-file-excel-o fa-lg"></i>  ',
                        title: 'Leave Cancellation History',
                        titleAttr: 'Excel'
                    },
                    {
                        extend: 'csvHtml5',
                        text: '<i class="fa fa-file-text-o fa-lg"></i>  ',
                        title: 'Leave Cancellation History',
                        titleAttr: 'CSV'
                    },
                    {
                        extend: 'pdfHtml5',
                        text: '<i class="fa fa-file-pdf-o fa-lg"></i>  ',
                        title: 'Leave Cancellation History',
                        titleAttr: 'PDF'
                    },
                    {
                        extend: 'print',
                        text: '<i class="fa fa-print fa-lg"></i>  ',
                        title: 'Leave Cancellation History',
                        titleAttr: 'Print'
                    }
                ]
            }).container().appendTo($('#buttons'));
        }

        $(document).on('click', '#leavecancel', function (e) {
          
            var leave_detail = {};
            leave_detail.emp_id = $(this).closest('tr').find('td').eq(1).attr('data_id');
            leave_detail.leave_type = $(this).closest('tr').find('td').eq(2).html();
            leave_detail.from_date = $(this).closest('tr').find('td').eq(3).html();
            leave_detail.to_date = $(this).closest('tr').find('td').eq(4).html();
            leave_detail.status = "Canceled";

            if (_functioncancel() == true) {
                $.ajax({
                    type: 'POST',
                    url: '/leave/cancelleavewithdraw',
                    contentType: 'application/json;charset=utf-8',
                    data: JSON.stringify({
                        'applyleaveid': $(this).attr('data-id'), 'status': 'Cancellation Submitted', leave_detail
                    }),
                    dataType: 'json',
                    success: function () {
                        window.location.reload(true);
                    }
                });
            } else { }

        });

        $(document).on('click', '#withdrawleave', function (e) {
            var apply_id = $(this).attr('data-id');
            var leave_detail = {};
            leave_detail.emp_id = $(this).closest('tr').find('td').eq(1).attr('data_id');
            leave_detail.leave_type = $(this).closest('tr').find('td').eq(2).html();
            leave_detail.from_date = $(this).closest('tr').find('td').eq(3).html();
            leave_detail.to_date = $(this).closest('tr').find('td').eq(4).html();
            leave_detail.status = "Withdrawn";

            swal({
                title: 'Are you sure',
                text: "You want to withdraw the applied leave ?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3f51b5',
                cancelButtonColor: '#ff4081',
                cancelButtonText: 'No ',
                confirmButtonText: 'Yes ',
                cancelButtonClass: 'btn btn-sm btn-danger',
                confirmButtonClass: 'btn btn-sm btn-primary',
                buttons: {
                    cancel: {
                        text: "No",
                        value: null,
                        visible: true,
                        className: "btn btn-danger",
                        closeModal: true,
                    },
                    confirm: {
                        text: "Yes",
                        value: true,
                        visible: true,
                        className: "btn btn-primary",
                        closeModal: true
                    }
                }

            }, function (isConfirm) {
                if (isConfirm == true) {

                 


                    $.ajax({
                        type: 'POST',
                        url: '/leave/cancelleavewithdraw',
                        contentType: 'application/json;charset=utf-8',
                        data: JSON.stringify({
                            'applyleaveid': apply_id, 'status': 'Withdrawn', leave_detail
                        }),
                        dataType: 'json',
                        success: function () {
                            window.location.reload(true);
                        }
                    });
                }
            });
        });
        



        ///////
        $("input[name='optradiocancelto']").attr('disabled', 'disabled');
        $("input[name='optradiocancelto']").prop("checked", false);
        $("input[name='optradiocancelfrom']").prop("checked", false);
        $('#txt_ctoDate').prop('disabled', true).css('background-color', 'lightgray');
        ///////////////

        $('#txt_cfromDate').datepicker("destroy");
        $('#txt_ctoDate').datepicker("destroy");
        var applyfromdate = new Date(myDateFormatter($('#txt_ffromDate').val()));
        var applytodate = new Date(myDateFormatter($('#txt_ttoDate').val()));
        $('#txt_cfromDate').datepicker({ dateFormat: "dd-M-yy", changeMonth: true, minDate: new Date(applyfromdate), maxDate: new Date(applytodate) }).attr('readonly', true).css('background-color', 'White');
        $('#txt_ctoDate').datepicker({ dateFormat: "dd-M-yy", changeMonth: true, minDate: new Date(applyfromdate), maxDate: new Date(applytodate) }).attr('readonly', true).css('background-color', 'White');
        $('#txt_cfromDate').on('change', function () {
            var datefrom = new Date(myDateFormatter($('#txt_cfromDate').val()));
            var dateto = new Date(myDateFormatter($('#txt_ttoDate').val()));
            $("input[name='optradiocancelto']").prop('disabled', false).prop('checked', false);
            $("input[name='optradiocancelfrom']").prop("checked", false);
            $("#txt_ctotalDate").val('');
            $('#txt_ctoDate').val("").prop('disabled', false);
            $('#txt_ctoDate').datepicker("destroy");
            $('#txt_ctoDate').datepicker({ dateFormat: "dd-M-yy", changeMonth: true, minDate: new Date(datefrom), maxDate: new Date(dateto) }).attr('readonly', true).css('background-color', 'White');

            if ($("#hiddenis_half_day").val() == 1) {
                $("input[name='optradiocancelfrom']").prop("disabled", true).prop('checked', false);
                $("input[name='optradiocancelto']").prop('disabled', true).prop('checked', false);
            } else {
                $("input[name='optradiocancelfrom']").prop("disabled", false);
                $("input[name='optradiocancelto']").prop('disabled', false);
            }

        });
         $("#btnapplycancelreset").click(function () {

             //$("input:radio").attr("checked", false);
             clearCancelText();
         });

         $(".close").click(function () {
             //$("input:radio").attr("checked", false);
             clearCancelText();
         });


         $('#btnapplycancellation').on('click', function () {

             if ($("#ddlleavetypeapply").val() == "0") {
                 alert('Please Select Leave Type !');
                 $("#ddlleavetypeapply").focus();
                 return false;
             }
             if ($("#ddlLeaveDays").val() == "0") {
                 alert('Please Select Leave Day !');
                 $("#ddlLeaveDays").focus();
                 return false;
             }
             if ($("#txt_ffromDate").val() == "") {
                 alert("From Date Can't be blank !");
                 $("#txt_fromDate").focus();
                 return false;
             }
             if ($("#txt_ttoDate").val() == "") {
                 alert("To Date Can't be blank !");
                 $("#txt_toDate").focus();
                 return false;
             }
             if ($("#txt_cfromDate").val() == "") {
                 alert("Cancel From Date Can't be blank !");
                 $("#txt_cfromDate").focus();
                 return false;
             }
             if ($("#txt_ctoDate").val() == "") {
                 alert("Cancel To Date Can't be blank !");
                 $("#txt_ctoDate").focus();
                 return false;
             }




             var data = new FormData();
             var files = $("#applyleavefile").get(0).files;
             if (files.length > 0) {
                 if (files.length <= 3) {
                     var filenamelist = [];
                     for (var i = 0; i < files.length; i++) {
                         filenamelist.push(files[i].name);
                         data.append(files[i].name, files[i]);
                         var isize = (files[i].size / 1024);
                         isize = (Math.round((isize / 1024) * 100) / 100);
                         if (isize > 2) {
                             alertify.alert("File must be less than 2MB").setHeader('<em> Message </em> ');
                             return false;
                         }
                     }
                     for (var i = 0; i < filenamelist.length; i++) {
                         var extension = filenamelist[i].split('.').pop().toUpperCase();
                         if (extension != "DOC" && extension != "DOCX" && extension != "XLS" && extension != "XLSX" && extension != "PPT" && extension != "PPTX" && extension != "PPS" && extension != "PPSX" && extension != "PDF" && extension != "TXT" && extension != "PNG" && extension != "JPG" && extension != "BMP" && extension != "RTF" && extension != "JPEG" && extension != "ZIP") {
                             alertify.alert("Invalid file format." + "(." + extension.toLowerCase() + ")").setHeader('<em> Message </em> ');
                             $("#applyleavefile").val('');
                             return false;
                         }

                     }
                 }
             }
             data.append("ID", $("#hiddenleaveapplyid").val());
             data.append("EmployeeID", $("#hiddenempid").val());
             data.append("LeaveTypeID", $("#ddlleavetypeapply").val());
             data.append("LeaveDay", $("#ddlLeaveDays").val());
             data.append("LeaveHalfDay", $("input:radio[name='optradio']:checked").length==0?"": $("input:radio[name='optradio']:checked").val());
             data.append("FromDate", $("#txt_ffromDate").val());
             data.append("ToDate", $("#txt_ttoDate").val());
             data.append("NumberofDays", $("#txt_ddays").val());
             data.append("CancelFromDate", $("#txt_cfromDate").val());
             data.append("CancelToDate", $("#txt_ctoDate").val());
             data.append("CancelLeaveHalffromDay", $("input:radio[name='optradiocancelfrom']:checked").length == 0 ? "" : $("input:radio[name='optradiocancelfrom']:checked").val());
             data.append("CancelLeaveHalftoDay", $("input:radio[name='optradiocancelto']:checked").length==0?"":$("input:radio[name='optradiocancelto']:checked").val());
             data.append("CancelNumberOfDays", $("#txt_ctotalDate").val());
             data.append("Remarks", $("#txtcancelremarks").val());
             $.ajax({
                 type: 'POST',
                 url: '/leave/Applyleavecancel',
                 data: data,
                 contentType: false, // Not to set any content header
                 processData: false, // Not to process data
                 success: function (response) {
                     var succ = response.SuccessMsg;
                     var err = response.ErrorMsg;
                     if (succ != "" && err == "") {
                         alert(succ);
                     }
                     else {
                         alert(err);
                     }
                     location.reload(true);
                 }
             });
         });

         $('#txt_ctoDate').on('change', function () {
            
             if ($('#txt_cfromDate').val() == '') {
                 alert("Start Date Can't be blank !");
                 $('#txt_ctoDate').val("");
             } else {
                 var start_dt = myDateFormatter($('#txt_cfromDate').val());
                 var end_dt = myDateFormatter($('#txt_ctoDate').val());
                     if ($("#hiddenis_half_day").val() == 1) {
                         $("input[name='optradiocancelfrom']").prop("disabled", true).prop('checked', false);
                         $("input[name='optradiocancelto']").prop('disabled', true).prop('checked', false);
                         var leftover = (new Date(end_dt) - new Date(start_dt)) / 1000;
                         var days = Math.floor(leftover / 86400) + 1;
                         $('#txt_ctotalDate').val(days);
                     } else {
                         $("input[name='optradiocancelfrom']").prop("disabled", false);
                         $("input[name='optradiocancelto']").prop('disabled', false);

                     if (start_dt > end_dt) {
                         alert("End Date can't less then start date.");
                         $('#txt_ctoDate').val("");
                         $('#txt_ctotalDate').val('');
                         setTimeout(function () { $('#txt_ctoDate').focus(); })
                     } else {

                         if (start_dt == end_dt) {
                             $("input[name='optradiocancelto']").attr('disabled', 'disabled');
                             $("input[name='optradiocancelto']").prop("checked", false);
                             if ($("input[name='optradiocancelfrom']").is(':checked') == true) {
                                 $('#txt_ctotalDate').val(0.5);
                             } else {
                                 var leftover = (new Date(end_dt) - new Date(start_dt)) / 1000;
                                 var days = Math.floor(leftover / 86400) + 1;
                                 $('#txt_ctotalDate').val(days);
                             }

                         } else {
                             $("input[name='optradiocancelto']").prop('disabled', false);
                             $("input[name='optradiocancelto']").prop("checked", false);
                             $("#rdcancelfirsthalftto").prop('disabled', false);
                             $("#rdcancelsecondhalftto").attr('disabled', 'disabled');

                             var leftover = (new Date(end_dt) - new Date(start_dt)) / 1000;
                             var days = "";
                            
                             if ($("#rdcancelSecondhalft").is(":checked") == true) {
                                 days = Math.floor(leftover / 86400) + 1 - 0.5;
                             } else {
                                 days = Math.floor(leftover / 86400) + 1;
                             }
                             $('#txt_ctotalDate').val(days);
                         }
                     }
                 }
             }
         });
         $('input[name="optradiocancelfrom"]').change(function () {
             $("#txt_ctoDate").val('');
             if ($("#txt_cfromDate").val() == "") {
                 alert("Start date can't be blank !");
                 $("#txt_cfromDate").focus();
                 $('input[name="optradiocancelfrom"]').prop("checked", false);
                 return false;
             } else {
                 $("#txt_ctotalDate").val(0.5);
                 if ($(this).val() == "First Half") {
                     $("#txt_ctoDate").val($("#txt_cfromDate").val()).css("background-color", "#eee").attr('disabled', 'disabled');
                     $("input[name='optradiocancelto']").attr('disabled', 'disabled');
                     $("input[name='optradiocancelto']").prop("checked", false);
                 }
                 if ($(this).val() == "Second Half") {
                     var start_dt = myDateFormatter($('#txt_cfromDate').val());
                     var end_dt = myDateFormatter($('#txt_ctoDate').val());
                     $("#txt_ctoDate").prop("disabled", false).css("background-color", "#fffff");
                     if (start_dt == end_dt) {
                         $("input[name='optradiocancelto']").prop('disabled', true);
                         $("input[name='optradiocancelto']").prop("checked", false);
                     } else {
                         $("input[name='optradiocancelto']").prop('disabled', false);
                         $("input[name='optradiocancelto']").prop("checked", false);
                         $("#rdcancelfirsthalftto").prop('disabled', false);
                         $("#rdcancelsecondhalftto").attr('disabled', 'disabled');
                     }


                 }
             }

             //if ($(this).is(':checked')) {
             //    alert($(this).val());
             //}
         });
         $('input[name="optradiocancelto"]').change(function () {
             if ($('#txt_ctoDate').val() == "" || $('#txt_cfromDate').val() == "") {
                 alert("Start date & End date can't be blank !");
                 $("#txt_ctotalDate").val('');
                 $("#rdcancelfirsthalftto").prop("checked", false);
             } else {
                 var start_dt = myDateFormatter($('#txt_cfromDate').val());
                 var end_dt = myDateFormatter($('#txt_ctoDate').val());
                 if ($('input[name="optradiocancelfrom"]').is(":checked") == true) {

                     if ($(this).is(":checked") == true) {
                         var leftover = (new Date(end_dt) - new Date(start_dt)) / 1000;
                         var days = Math.floor(leftover / 86400);
                         $('#txt_ctotalDate').val(days);
                     }

                 } else if ($('input[name="optradiocancelfrom"]').is(":checked") != true) {
                     if ($(this).is(":checked") == true) {
                         var leftover = (new Date(end_dt) - new Date(start_dt)) / 1000;
                         var days = Math.floor(leftover / 86400) + 1 - 0.5;
                         $('#txt_ctotalDate').val(days);
                     }
                 }
             }

         });

    });
    function clearCancelText() {
        $("#txt_cfromDate").val('');
        $("#txt_ctoDate").val('').prop("readonly", false);
        $("#txt_ctotalDate").val('');
        $("#txtcancelremarks").val('');
        $(".fromcheck").prop("checked", false);
    }

    function myDateFormatter(dateObject) {
        var d = new Date(moment(dateObject, '"DD-MMM-YYYY').format());
        var day = d.getDate();
        var month = d.getMonth() + 1;
        var year = d.getFullYear();
        if (day < 10) {
            day = "0" + day;
        }
        if (month < 10) {
            month = "0" + month;
        }
        var date = year + "/" + month + "/" + day;

        return date;
    };
    //function showSwal(T) {


    //    swal({
    //        title: 'Are you sure',
    //        text: "You want to withdraw the applied leave ?",
    //        icon: 'warning',
    //        showCancelButton: true,
    //        confirmButtonColor: '#3f51b5',
    //        cancelButtonColor: '#ff4081',
    //        cancelButtonText: 'No ',
    //        confirmButtonText: 'Yes ',
    //        cancelButtonClass: 'btn btn-sm btn-danger',
    //        confirmButtonClass: 'btn btn-sm btn-primary',
    //        buttons: {
    //            cancel: {
    //                text: "No",
    //                value: null,
    //                visible: true,
    //                className: "btn btn-danger",
    //                closeModal: true,
    //            },
    //            confirm: {
    //                text: "Yes",
    //                value: true,
    //                visible: true,
    //                className: "btn btn-primary",
    //                closeModal: true
    //            }
    //        }

    //    }, function (isConfirm) {
    //        if (isConfirm == true) {

    //            var leave_detail = {};
    //            leave_detail.emp_id = "";
    //            leave_detail.leave_type = "";
    //            leave_detail.from_date = "";
    //            leave_detail.to_date = "";
    //            leave_detail.status = "Withdrawn";


    //            $.ajax({
    //                type: 'POST',
    //                url: '/leave/cancelleavewithdraw',
    //                contentType: 'application/json;charset=utf-8',
    //                data: JSON.stringify({
    //                    'applyleaveid': T, 'status': 'Withdrawn', leave_detail
    //                }),
    //                dataType: 'json',
    //                success: function () {
    //                    window.location.reload(true);
    //                }
    //            });
    //        }
    //    });
    //}
    function LeaveBalance(table1) {
        table1.rows().remove().draw();
        $("#btn_search").text("Loading ...").prop("disabled", true);
        $.ajax({
            type: 'POST',
            url: '/leave/leavebalanceshow',
            data: JSON.stringify({ 'year': $("#ddl_year").val() }),
            contentType: 'application/json;charset=utf-8',
            dataType: 'json',
            success: function (data) {
                var mydata = JSON.parse(data.msg);
                table1.clear().draw();
                $("#btn_search").text("Search").prop("disabled", false);
                if (mydata.length > 0) {

                    for (var i = 0; i < mydata.length; i++) {
                        var markup = "";
                        markup += "<tr id='row" + i + "'>";
                        markup += "<td> " + (parseInt(i) + 1) + "</td > ";
                        markup += "<td> " + mydata[i].EMPLOYEE_NAME + "</td > ";
                        markup += "<td> " + mydata[i].LEAVE_TYPE + "</td > ";
                        markup += "<td> " + mydata[i].OPENING_BAL + "</td > ";
                        markup += "<td> " + mydata[i].CURRENT_ENTITLEMENT + "</td > ";
                        markup += "<td> " + mydata[i].LEAVES_AVAILED + "</td > ";
                        //markup += "<td> " + mydata[i].ADJESTMENT_DAYS + "</td > ";
                        markup += "<td> " + mydata[i].CLOSING_BAL + "</td > ";
                        markup += "</tr>";
                        table1.row.add($(markup)).draw();
                    }
                } else {
                    table1.reload();
                }


            }

        });
    }
    function _functioncancel() {

        if (confirm("Are you sure you want to cancel leave ?")) {
            return true;
        } else {
            return false;
        }
    }


</script>
<div class="row">
    <div class="col-sm-8">
        <h4 class="page-title">Leave Cancellation   </h4>
    </div>

    <div class="col-sm-1 text-right m-b-30">
        <a href="#" class="btn btn-primary rounded" id="btn_leave_balance_show" data-toggle="modal" data-target="#Leave_Balance"> Leave Balance</a>
        <input type="hidden" id="hdn_roleId" value="@Session["role_id"]" />
        <input type="hidden" id="hdn_managerId" value="@Session["manager_id"]" />
    </div>
     
    <div class="col-sm-3 text-right m-b-30" id="buttons">
    </div>
</div> 
<div class="row">
    <div class="col-md-12">
        <div>
            <table id="leavecancelapply" class="table table-striped custom-table m-b-0 tbl_leavecancelhistory">
                <thead>
                    <tr>
                        <th width="45px">Sr.</th>
                        <th>Employee</th>
                        <th>Leave Type</th>
                        <th>From Date</th>
                        <th>To Date</th>
                        <th  class="Noofdays" >No. Of Days</th>
                        @*<th>Remarks</th>*@
                        <th class="text-center">Status</th>
                      
                        <th class="text-center">Action </th>
                    </tr>
                </thead>
                <tbody>
                    @{
                        int sno = 0;
                    }
                    @foreach (var item in Model.Tables[0].Rows)
                    {
                        if (@item["STATUS"].ToString().Trim() != "Withdrawn")
                        {


                        <tr>
                            @*<td>@item["SR_NO"]</td>*@
                            <td>@{ sno++; }@sno</td>
                            <td data_id="@item["EMPLOYEE_CODE"]" ><span>@item["EMPLOYEE_NAME"]</span>@*<br /><span>@item["EMPLOYEE_CODE"]</span>*@</td>
                            <td>@item["LEAVE_TYPE_NAME"]</td>
                            <td>@item["LEAVE_FROM_DATE"]</td>
                            <td>@item["LEAVE_TO_DATE"]</td>
                            <td>@item["NUMBER_OF_DAYS"]</td>
                            @*<td>@item["DESCRIPTION"]</td>*@
                            <td class="text-center" width="10px">

                                @if (@item["STATUS"].ToString().Trim() == "Submitted")
                                {
                                    <label class="badge bg-warning" >&nbsp;&nbsp;@item["STATUS"]&nbsp;&nbsp;</label>
                                }
                                else if (@item["STATUS"].ToString().Trim() == "Cancellation Submitted")
                                {
                                    <label class="badge bg-warning" style="white-space: pre-line">&nbsp;&nbsp;@item["STATUS"]&nbsp;&nbsp;</label>
                                }
                                else if (@item["STATUS"].ToString().Trim() == "Approved")
                                {
                                    <label class="badge bg-success" >&nbsp;&nbsp;@item["STATUS"]&nbsp;&nbsp;</label>
                                }
                                else if (@item["STATUS"].ToString().Trim() == "Cancellation Approved")
                                {
                                    <label class="badge bg-success" style="white-space: pre-line;pointer-events:none">&nbsp;&nbsp;@item["STATUS"]&nbsp;&nbsp;</label>
                                }
                                else if (@item["STATUS"].ToString().Trim() == "Rejected")
                                {
                                    <label class="badge" style="white-space: pre-line;background-color:#FC0404" >&nbsp;&nbsp;@item["STATUS"]&nbsp;&nbsp;</label>
                                }
                                else if (@item["STATUS"].ToString().Trim() == "Cancellation Rejected")
                                {
                                    <label class="badge" style="white-space: pre-line;background-color:#FC0404">&nbsp;&nbsp;@item["STATUS"]&nbsp;&nbsp;</label>
                                }
                                @*else if (@item["STATUS"].ToString().Trim() == "Withdrawn")
                                {
                                    <label class="badge" style="white-space: pre-line;background-color:#FC0404">&nbsp;&nbsp;@item["STATUS"]&nbsp;&nbsp;</label>
                                }*@
                            </td>


                            <td class="text-center">
                        
                                @if (@item["STATUS"].ToString().Trim() == "Submitted")
                                {
                                <a href="javascript:;"  id="withdrawleave" data-id="@item["ID"]" @*onclick="showSwal(@item["ID"])"*@ title="Withdraw Leave">
                                    <span class="badge bg-danger">Withdraw </span>
                                </a>
                                }

                                else if (@item["STATUS"].ToString().Trim() == "Cancellation Approved")
                                {
                                <a href="" style="pointer-events:none"  id="leavecancel" data-id="@item["ID"]" title="Cancel">
                                   
                                     <span class="badge bg-danger">Cancel</span>
                                </a>
                                }
                                else
                                {
                                    <a href="" id="leavecancel" data-id="@item["ID"]" title="Cancel">

                                        <span class="badge bg-danger">Cancel</span>
                                    </a>
                                }

                            </td>

                        </tr>
                        }
                    }


                </tbody>
                 
</table>
         
        </div>
    </div>
</div>

<div id="View_Policy" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h4 class="modal-title"> Leave Policy View</h4>
            </div>

            <div class="modal-body">

                <form>
                    <div class="tab-pane active card-box" role="tabpanel" id="complete">

                        <div id="DivLeavePolicy"><h4>Leave Policy</h4> <div class="row"><label class="col-sm-2">Leave Type </label>  <div class="col-sm-10"> <div id="lblLeaveType">Casual Leave</div></div> </div> <div class="row"><label class="col-sm-2">Policy Name </label>  <div class="col-sm-10"><div id="lblPolicyName">Casual Leave Policy</div></div> </div> <div class="row"><label class="col-sm-2">Policy Description  </label>  <div class="col-sm-10"> <span id="lblDesc"></span></div> </div> <div class="row"><label class="col-sm-2">Start Date </label>  <div class="col-sm-10"> <div id="lblEffectiveStartDate">01-Jan-2018</div></div> </div> <div class="row"><label class="col-sm-2">End Date</label>  <div class="col-sm-10"> <div id="lblEffectiveEndDate"></div></div> </div> <div class="row"><label class="col-sm-2">Status</label>  <div class="col-sm-10"> <div id="lblEffectiveEndDate">Active</div></div> </div></div>
                        <div id="DivLeavePlan"><h4>Leave Plan</h4> <div class="row"><label class="col-sm-2">Gender </label>  <div class="col-sm-10"> <div id="lblLeaveType">All</div></div> </div> <div class="row"><label class="col-sm-2">Leave Limits </label>  <div class="col-sm-10"><input type="checkbox" id="chkIncludePublicHolidaysreview" disabled="" class="form-check-input">  Include Public Holidays   <br /> <input type="checkbox" id="chkIncludeWeekendsreview" disabled="" class="form-check-input">  Include Weekends <br />   <input type="checkbox" id="chkyeaeclubbed" checked="" disabled="" class="form-check-input">   Can be Clubbed With  EL  <br /><input type="checkbox" id="chkyeaeclubbed" checked="" disabled="" class="form-check-input">   Can be Clubbed With  CL</div> </div> <div class="row"><div class="col-sm-2"> </div>  <div class="col-sm-10"> <table class="table table-striped custom-table m-b-0 datatable"><tbody><tr><th>Period </th> <th>Grade</th><th>No. Of Days</th><th>UOM</th><th>Start Date</th> <th>End Date</th><th>Credit </th>   <th> Notice Period   </th> <th> Probation Period </th><th> Confirmed </th></tr><tr><td>Year </td><td>All </td><td>3 </td><td>Day </td><td>1-Jan-2018 </td><td>  </td> <td>Start Of Period  </td> <td><input type="checkbox" disabled="" name="name" value=""> </td> <td><input type="checkbox" disabled="" name="name" value=""> </td><td><input type="checkbox" disabled="" checked="" name="name" value=""> </td> </tr></tbody></table></div> </div></div>
                        <div id="DivYearEndProcessing"><h4>Year End Processing</h4> <div class="row"><label class="col-sm-2">Allow Carryover </label>  <div class="col-sm-10"> Carryover Limit  :<label id="lblCarryoverLimit">4</label></div> </div> <div class="row"><label class="col-sm-2">Pay at Year end </label>  <div class="col-sm-10"> Min. Balance Need To be Maintained  :<label id="lblCarryoverLimit">4</label></div> </div> <div class="row"><label class="col-sm-2">Eligible For Encashment</label>  <div class="col-sm-10">Encashment Limit :<label id="lblCarryoverLimit">4</label></div> </div> <div class="row"><div class="col-sm-2"> </div>  <div class="col-sm-10">Min. Balance Need To be Maintained :<label id="lblCarryoverLimit">4</label></div> </div><div class="row"><label class="col-sm-2">Carry Forward to EL </label>  <div class="col-sm-10">Carray forward Limit:<label id="CarrayForYear">2</label></div> </div></div>

                    </div>

                </form>
            </div>
        </div>
    </div>
</div>
<div id="Apply_Leave" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h4 class="modal-title">Apply Cancellation Apply</h4>
            </div>
            <div class="modal-body">
                <form class="m-b-30">
                    <div class="row">

                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label">Employee <span class="text-danger">*</span></label>
                                @Html.DropDownList("ddlemployeeapplce", (IEnumerable<SelectListItem>)ViewBag.DDEMPLOYEE, new { @class = "form-control", @disabled = "disabled" })
                                 <input type="hidden" value="@Session["emp_id"]" id="hiddenempid" />
                                 <input type="hidden" id="hiddenleaveapplyid" />
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label">Leave Type <span class="text-danger">*</span></label>
                               

                                @Html.DropDownList("ddlleavetypeapply",(IEnumerable<SelectListItem>)ViewBag.LeaveType, "Medical Leave",new { @class="form-control", @onchange = "if ($(this).val() == 0) { $('#txtleavebalance').val(''); } else { $('#txtleavebalance').val('3'); }" ,@disabled= "disabled" })
                            </div>
                        </div> 
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label">Number of Days  </label>
                                <input type="text" id="txt_ddays"  class="form-control" disabled="disabled">
                            </div>
                        </div> 
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label">Leave Day <span class="text-danger">*</span></label> <br />

                                <label class="radio-inline">
                                    <input type="radio" id="fromfirsthalf" value="First Half" disabled name="optradio">First Half
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" id="fromsecondhalf" disabled value="Second Half" name="optradio">Second Half
                                </label>
                                @Html.DropDownList("ddlLeaveDays", (IEnumerable<SelectListItem>)ViewBag.LeaveDay, "Full Day", new { @class = "form-control", @onchange = "LeaveSelect()", @disabled = "disabled" })
                            </div>
                        </div>


                 <div class="col-sm-4">
                        <div class="form-group">
                            <label class="control-label">From Date <span class="text-danger">*</span></label>
                            <br />
                            <br />
                            <div class="cal-icon"><input type="text" readonly="readonly" id="txt_ffromDate" placeholder="dd mm yyyy"   class="form-control" ></div>
                            <br />
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label class="control-label">To Date <span class="text-danger">*</span></label>
                            <br />
                            <br />
                            <div class="cal-icon"><input type="text" readonly="readonly" placeholder="dd mm yyyy" class="form-control  todate"   id="txt_ttoDate"></div>
                            <br />
                        </div>
                    </div>
                  
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label class="control-label">Cancel From Date <span class="text-danger"> *</span></label> 
                            <br />
                            <label class="radio-inline">
                                <input type="radio" id="rdcancelfirsthalft" class="fromcheck" value="First Half" name="optradiocancelfrom">First Half
                            </label>
                            <label class="radio-inline">
                                <input type="radio" id="rdcancelSecondhalft" class="fromcheck" value="Second Half" name="optradiocancelfrom">Second Half
                            </label>
                            <div class="cal-icon"><input type="text" autocomplete="off" id="txt_cfromDate" placeholder="dd-mmm-yyyy" class="form-control mycal " onclose="test();"></div>
                        </div>
                    </div>
                       
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label class="control-label"> Cancel To Date <span class="text-danger"> *</span></label> 
                            <br />
                            <label class="radio-inline">
                                <input type="radio" class="fromcheck" id="rdcancelfirsthalftto" value="First Half" name="optradiocancelto">First Half
                            </label>
                            <label class="radio-inline">
                                <input type="radio" class="fromcheck" id="rdcancelsecondhalftto" value="Second Half" name="optradiocancelto">Second Half
                            </label>
                            <div class="cal-icon"><input type="text" autocomplete="off" placeholder="dd-mmm-yyyy" class="form-control mycal" id="txt_ctoDate"></div>
                        </div>
                    </div>

                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label"> Net No Of Days<span class="text-danger"> *</span></label>
                                <br />
                                <br />
                              <input type="text" autocomplete="off"   class="form-control " readonly id="txt_ctotalDate"> 
                                <br />
                            </div>
                        </div>
                      
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label">Cancel Remarks </label>
                                <textarea placeholder="Cancel Remarks" id="txtcancelremarks" class="form-control"></textarea>
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group">
                                <label class="control-label">Attachment </label>
                                <input type="file" id="applyleavefile" class="form-control ">
                            </div>
                        </div>
                    </div>

                    <div class="m-t-20 text-center">
                        <input type="hidden" id="hiddenis_half_day"  name="name" value="" />
                        <input type="submit" class="btn btn-primary" id="btnapplycancellation" value="Apply Cancellation"/>
                        <input  type="button" id="btnapplycancelreset"  class="btn btn-primary"    value="Reset" /> 
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

 <div id="Leave_Balance" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <div class="modal-content modal-lg modal-lg-leaveBal">
            <div class="modal-header modal-title">
                @*<h4 class="modal-title">Leave Balance</h4>*@


            </div>
            <div class="modal-body">

                <div class="row">
                    <div class="col-sm-6"><h4>Leave Balance</h4></div>
                    <div class="col-sm-6 "> <div class="pull-right" id="buttonsleavebalance"></div></div>
                </div>
                <div class="row">

                    <div class="col-sm-2 col-xs-6">
                        <div class="form-group form-focus select-focus focused">
                            <label class="control-label">Select Year</label>
                            <select style="border-radius:32px;height: 36px; padding: 13px 12px 6px;" class="form-control" id="ddl_year">
                                <option value="0">Select</option>
                                <option value="2018">2018</option>
                                <option value="2019">2019</option>
                                <option value="2020">2020</option>
                                <option value="2021">2021</option>
                                <option value="2022">2022</option>
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-sm-2 col-xs-6">
                        <button type="button" class="btn btn-success btn-block" style="border-radius:32px;" id="btn_search"> Search </button>

                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-12">
                        <div class="radio" id="div_leavebalance">
                            <label class="radio-inline">
                                <input type="radio" value="Self" name="leaveoptradio">Self
                            </label>
                            @if (Session["manager_id"] != null)
                            {
                                <label class="radio-inline">
                                    <input type="radio" value="Subordinate" name="leaveoptradio">Subordinate
                                </label>
                            }

                        </div>
                    </div>

                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table id="tbl_leavebalance" class="table table-striped custom-table m-b-0 tbl_leavebalance">
                                <thead>
                                    <tr>
                                        <th width="45px">
                                            Sr.
                                        </th>
                                        <th width="160px">
                                            Employee
                                        </th>
                                        <th>Leave Type</th>
                                        @*<th>Start Date</th>*@
                                        <th>Opening Balance</th>
                                        <th>Current Entitlement</th>
                                        <th>Leaves Availed</th>
                                        @*<th >Adjustment Days</th>*@
                                        <th>Closing Balance</th>
                                        @*<th>  </th>*@
                                    </tr>
                                </thead>

                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                </form>
            </div>
        </div>
    </div>
</div>